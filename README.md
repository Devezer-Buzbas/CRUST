# `CRUST` Conceptualizing Reproducibility Using Simulations and Theory

## Software Pre-requisites

The CRUST theoretical and agent-based simulation models are written in [**R Statistics**](https://www.r-project.org/), thus it can be run on any R-supported operating system. In addition to **R v3.3.2+**, these implementations use a set of existing libraries that need to be installed prior to their execution:

* `caTools v.1.17.1`
* `data.table v.1.10.4-3`
* `ggplot2 v.2.2.1`
* `permute v.0.9-4`
* `matrixStats v.0.53.1`
* `MCMCpack v.1.4-2`

## Download Repository from GitHub
* Open a terminal
* Navigate to the directory where you want to download the CRUST code
* Type: **git clone https://github.com/gnardin/CRUST.git**

## Theoretical Simulation Model

## Agent-Based Simulation Model

The agent-based model (ABM) version of the reproducibility model is a forward-in-time simulation-based implementation of a process at the individual level. In our ABM, each scientist is represented as an agent that updates the scientific community consensus. ABM helps us assess interesting properties of our scientific process by allowing the inclusion of replication in the system.

### Files and Functions

The _reproducibility.R_ is the main script to execute the reproducibility simulation. This script requires several other auxiliary functions in the `functions` directory.

| Script File Name              | Function                  | Description |
|-------------------------------|---------------------------|-------------|
| _analysis.R_                  | `analysis(sModel, gModel, yset, xset, weights)` | Calculate the statistics for the selected and the global models assuming data generated under the True Model, randomly generated X values, and betas weigths. |
| _calculateDet.R_              | `calculateDet(model, xset, weights, betas)` | Calculate the deterministic part of a model |
| _calculateDistance.R_         | `calculateDistance(betas1, betas2)` | Calculate the distance among betas of two models |
| _compareModels.R_             | `compareModels(model1, model2)` | Compare if two models are the equal |
| _constants.R_                 |                                 | Define all the constants |
| _convertBinary.R_             | `convertBinary(v, k)` | Convert a number into binary format |
| _generateBetas.R_             | `generateBetas(models)` | Set the weights of all betas |
| _generateModels.R_            | `generateModels(k)` | Generate all possible models with factor k |
| _generateXSet.R_              | `generateXSet(n, k, correlation)` | Generate a set n of predictor values |
| _generateY.R_                 | `generateY(deterministic, sigma)` | Generate a set of stochastic values under the True Model |
| _getBetas.R_                  | `getBetas(model, weights, sigma)` | Generate a set of random betas to the True Model |
| _getPredictors.R_             | `getPredictors(models)` | Get a list of predictors of all models |
| _modelSimilarByInteraction.R_ | `modelSimilarByInteraction(model, models, mode=["all", "random"])` | modelSimilarByInteraction | Generate a simular model adding an interaction |
| _modelSimilarByTerm.R_        | `modelSimilarByTerm(model, models, mode=["all", "random"])` | Generate a similar model adding or removing a term |
| _modelToStr.R_                | `modelToStr(model)` | Convert a model represented as a matrix into a string format |
| _searchModel.R_               | `searchModel(model, models)` |Search for the index of the model in a list of models |
| _seedGenerator.R_             | `seedGenerator(N, filename)` | Upload seeds from a text file or generate them randomly |
| _simulator.R_                 | `simulator(replications, timesteps, models, k, tModel, nRey, nTess, nBo, nMave, weights, sampleSize, correlation, sigma, modelCompare, inputDir, outputDir, outputFile, paramFile, verbose, ndec, seeds)` | Execute a certain number of replications of the reproducibility model |
| _strToModel.R_                | `strToModel(modelStr, k)` | Convert a model represented as a string into a matrix format |

The _summary.R_ script is used to summarize data generated by a completely randomized factorial design experiment.

### Configuration
You can configure the `CRUST` ABM by changing the values of the parameters in the _reproducibility.R_ script file. The table below describes the configuration parameters for the `CRUST` ABM model.

| **Parameter** | **Description** |
| :------------ | :-------------- |
| `baseDir`       | Full path to the base directory of `CRUST` |
| `replications`  | Number of replications to run the simulation |
| `timesteps`     | Number of time steps of the simulation |
| `k`             | Maximum number of factors of models |
| `sigma`         | Error variance |
| `sampleSize`    | Size of the set of stochastic values generated under the True Model |
| `trueModel`     | Set the True Model |
| `correlation`   | Correlation of the predictor values |
| `nRey`          | Number of agents of the \textit{Rey} type |
| `nTess`         | Number of agents of the \textit{Tess} type |
| `nBo`           | Number of agents of the \textit{Bo} type |
| `nMave`         | Number of agents of the \textit{Maverick} type |
| `modelCompare`  | Type of comparison statistic: `TSTATISTICS` $t$ statistics, `RSQ` R-Squared, `ARSQ` Adjusted R-Squared, `AIC` Akaike Information Criterion, `BIC` Bayesian Information Criterion |
| `outputFile`    | Name of the file storing the simulation output data |
| `paramFile`     | Name of the file storing the parameters of the simulation |
| `verbose`       | Echo messages during the simulation execution |
| `ndec`          | Decimal precision of the stored values |

### Execution

To execute the reproducibility simulation:

* Navigate to the _CRUST_ folder
* Edit the _src/abm/reproducibility.R_ script file and set the parameters described in the **Configuration**
* Execute: **Rscript src/abm/reproducibility.R --no-save**
